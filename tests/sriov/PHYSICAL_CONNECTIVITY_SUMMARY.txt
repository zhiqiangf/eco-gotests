â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                            â•‘
â•‘       SR-IOV OPERATOR NETWORKING TEST                                     â•‘
â•‘       Physical Connectivity Requirements Analysis                         â•‘
â•‘                                                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ğŸ¯ QUICK ANSWER: What Physical Connectivity Does This Test Need?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

The test requires REAL SR-IOV hardware with REAL network connectivity:

1. ğŸ”Œ SR-IOV capable NIC (Intel X520, Mellanox ConnectX-5, etc.)
2. ğŸŒ Physical network cable connected to switch
3. ğŸ“¦ Virtual Functions allocated from Physical Function
4. ğŸ”— Physical link UP (carrier status)
5. ğŸ“Š Routable IP subnets for test traffic


âŒ TEST CANNOT RUN ON:
- Virtual machines (unless with SR-IOV passthrough)
- Clusters without SR-IOV NICs
- Disconnected network interfaces
- With only 1 Virtual Function (needs minimum 2 per test)


âœ… MUST HAVE FOR TEST:
- 6-8 Virtual Functions available
- 192.168.100.0/24 - 192.168.201.0/24 IP ranges routable
- IPv6 fd00:192:168:100::/64 - fd00:192:168:201::/64 (for IPv6 tests)


ğŸ—ï¸ NETWORK ARCHITECTURE FOR TEST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Physical Network (External)
    â”‚
    â”œâ”€ Managed Ethernet Switch
    â”‚
    â””â”€ Worker Node
       â”‚
       â”œâ”€ Physical NIC (PF: ens1f0)
       â”‚  â”‚
       â”‚  â”œâ”€ VF 0 â†’ Pod 1 (client-wb)
       â”‚  â”‚         eth1: net1
       â”‚  â”‚         IP: 192.168.100.10/24
       â”‚  â”‚         â†“ (ping)
       â”‚  â”œâ”€ VF 1 â†’ Pod 2 (server-wb)
       â”‚  â”‚         eth1: net1
       â”‚  â”‚         IP: 192.168.100.11/24
       â”‚  â”‚
       â”‚  â””â”€ Carrier Status: UP
       â”‚
       â””â”€ Pod Connectivity Path:
          client-pod â†’ VF 0 â†’ PF (ens1f0) â†’ Switch â†’ PF (ens1f0) â†’ VF 1 â†’ server-pod


ğŸ“‹ TEST SCENARIOS & THEIR REQUIREMENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Test 1: IPv4 with Whereabouts IPAM (Lines 67-227)
â”œâ”€ Scenario: Two pods communicate over SR-IOV with automatic IP assignment
â”œâ”€ Physical Requirements:
â”‚  â”œâ”€ PF carrier status: UP
â”‚  â”œâ”€ IP range: 192.168.100.0/24
â”‚  â”œâ”€ VF count: 2 minimum
â”‚  â”œâ”€ Ping command: must work
â”‚  â””â”€ Expected: 3 packets transmitted and received
â”‚
â”œâ”€ Phases:
â”‚  â”œâ”€ Phase 1: Whereabouts IPv4 (automatic IP from 192.168.100.0/24)
â”‚  â”‚  â””â”€ If NO-CARRIER: Connectivity tests skipped, test passes
â”‚  â”‚
â”‚  â””â”€ Phase 2: Static IPv4 (fixed IP: 192.168.101.10/24, 192.168.101.11/24)
â”‚     â””â”€ If NO-CARRIER: Connectivity tests skipped, test passes


Test 2: IPv6 with Whereabouts IPAM (Lines 229-378)
â”œâ”€ Scenario: Two pods communicate over SR-IOV with IPv6
â”œâ”€ Physical Requirements:
â”‚  â”œâ”€ IPv6 enabled on cluster nodes (detected at runtime)
â”‚  â”œâ”€ IPv6 enabled on physical network
â”‚  â”œâ”€ PF carrier status: UP
â”‚  â”œâ”€ IPv6 ranges:
â”‚  â”‚  â”œâ”€ fd00:192:168:100::/64 (Whereabouts)
â”‚  â”‚  â””â”€ fd00:192:168:101::/64 (Static)
â”‚  â”œâ”€ VF count: 2 minimum
â”‚  â”œâ”€ ping6 command: must work
â”‚  â””â”€ If NOT available: Test skipped
â”‚
â”œâ”€ IPv6 Detection (Line 230-235):
â”‚  â””â”€ detectIPv6Availability() checks node addresses for ":"
â”‚     If no ":" found â†’ Skip: "IPv6 is not enabled on worker nodes"


Test 3: Dual-Stack (IPv4 + IPv6) (Lines 380-531)
â”œâ”€ Scenario: Two pods communicate with both IPv4 and IPv6
â”œâ”€ Physical Requirements:
â”‚  â”œâ”€ All IPv4 requirements (2 ranges: 192.168.200.0/24, 192.168.201.0/24)
â”‚  â”œâ”€ All IPv6 requirements (2 ranges: fd00:192:168:200::/64, fd00:192:168:201::/64)
â”‚  â”œâ”€ PF carrier status: UP
â”‚  â”œâ”€ VF count: 4 minimum (2 per test type)
â”‚  â”œâ”€ ping: must work (IPv4 test)
â”‚  â”œâ”€ ping6: must work (IPv6 test)
â”‚  â””â”€ Both must succeed for test to pass


ğŸ”Œ CARRIER STATUS CHECK (Critical for Connectivity)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Code Location: Lines 138, 209, 299, 361, 450, 513

    clientCarrier, err := checkInterfaceCarrier(clientPod, "net1")
    
    if !clientCarrier {
        // NO-CARRIER detected
        GinkgoLogr.Info("Interface has NO-CARRIER status, skipping connectivity test")
        // Skip ping/ping6 but continue test
    } else {
        // CARRIER UP
        // Run ping/ping6 tests
        err = validateWorkloadConnectivity(...)
    }

Meanings:
  âœ… CARRIER UP    â†’ Physical link connected
                     Ping/ping6 tests run
                     
  âŒ NO-CARRIER    â†’ Physical cable unplugged (or switch port down)
                     Ping/ping6 tests skipped
                     Test still PASSES (graceful degradation)


ğŸª VF ALLOCATION CHECK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Code Location: Lines 72-79

    for _, data := range testData {
        result := initVF(data.Name, data.DeviceID, data.InterfaceName, 
                        data.Vendor, sriovOpNs, vfNum, workerNodes)
        if result {
            executed = true
            break
        }
    }
    
    if !executed {
        Skip("No SR-IOV devices available for IPv4 networking testing")
    }

What This Does:
  1. Tries to allocate VFs on available SR-IOV devices
  2. If successful: Test runs
  3. If fails: Test skipped

Why It Fails:
  âŒ No SR-IOV capable NICs on cluster
  âŒ SR-IOV driver not loaded
  âŒ Not enough VFs available
  âŒ IOMMU not enabled in BIOS


ğŸ“Š DETAILED CONNECTIVITY FLOW FOR IPv4 TEST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Test Setup
   â”œâ”€ Create namespace: e2e-ipv4-whereabouts-...
   â”œâ”€ Create SR-IOV network: ipv4-whereabouts-net-...
   â””â”€ Operator creates NAD (NetworkAttachmentDefinition)

2. Pod Creation
   â”œâ”€ Pod 1: client-wb
   â”‚  â”œâ”€ Annotation: k8s.v1.cni.cncf.io/networks: 
   â”‚  â”‚              [{name: "ipv4-whereabouts-net-...", 
   â”‚  â”‚                ips: ["192.168.100.10/24"], 
   â”‚  â”‚                mac: "20:04:0f:f1:a0:01"}]
   â”‚  â”œâ”€ VF 0 assigned
   â”‚  â””â”€ IP: 192.168.100.10/24
   â”‚
   â””â”€ Pod 2: server-wb
      â”œâ”€ Annotation: same, different IP
      â”œâ”€ VF 1 assigned
      â””â”€ IP: 192.168.100.11/24

3. Verification Steps
   â”œâ”€ Both pods reach "Ready" state (10 min timeout)
   â”œâ”€ Check pod has SR-IOV interface (net1)
   â”œâ”€ Check interface carrier status
   â”‚  â”œâ”€ If UP: Continue to connectivity test
   â”‚  â””â”€ If NO-CARRIER: Skip connectivity, continue next phase
   â”‚
   â””â”€ Connectivity Test (if carrier UP)
      â”œâ”€ Execute: ping -c 3 192.168.100.11 (from client pod)
      â”œâ”€ Retry: Every 5 seconds, max 2 minutes
      â”œâ”€ Expected: 3 packets transmitted and received
      â””â”€ Result:
         âœ… PASS if pings succeed
         âŒ FAIL if ping times out after 2 minutes

4. Pod Cleanup
   â”œâ”€ Delete client-wb pod
   â”œâ”€ Delete server-wb pod
   â””â”€ Delete network and namespace


âš™ï¸ WHAT FAILS WITHOUT PROPER PHYSICAL CONNECTIVITY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Scenario 1: NO SR-IOV HARDWARE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Test runs initVF()                           â”‚
â”‚ â†“                                            â”‚
â”‚ No SR-IOV devices found                      â”‚
â”‚ â†“                                            â”‚
â”‚ result = false                               â”‚
â”‚ â†“                                            â”‚
â”‚ Skip("No SR-IOV devices available...")       â”‚
â”‚ â†“                                            â”‚
â”‚ TEST SKIPPED âŠ˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario 2: PHYSICAL CABLE UNPLUGGED
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pods created successfully                    â”‚
â”‚ â†“                                            â”‚
â”‚ checkInterfaceCarrier() returns NO-CARRIER   â”‚
â”‚ â†“                                            â”‚
â”‚ Connectivity tests skipped                   â”‚
â”‚ â†“                                            â”‚
â”‚ TEST PASSED (graceful degradation) âœ“         â”‚
â”‚ Note: Ping tests not run, so no failure      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario 3: NO NAD CREATED (OPERATOR BUG)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pod creation attempts                        â”‚
â”‚ â†“                                            â”‚
â”‚ CNI plugin cannot find network attachment    â”‚
â”‚ â†“                                            â”‚
â”‚ Pod stuck in "ContainerCreating"             â”‚
â”‚ â†“                                            â”‚
â”‚ WaitUntilReady() times out (10 min)          â”‚
â”‚ â†“                                            â”‚
â”‚ TEST FAILS âœ—                                 â”‚
â”‚ Error: "Client pod should be ready"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario 4: PING FAILS (NETWORK ISSUE)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pods created                                 â”‚
â”‚ Carrier: UP                                  â”‚
â”‚ â†“                                            â”‚
â”‚ Ping command executed every 5 seconds        â”‚
â”‚ â†“                                            â”‚
â”‚ All pings fail                               â”‚
â”‚ â†“                                            â”‚
â”‚ 2 minute timeout reached                     â”‚
â”‚ â†“                                            â”‚
â”‚ TEST FAILS âœ—                                 â”‚
â”‚ Error: "ping6 test failed: unexpected..."    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ğŸ“ NETWORK SUBNETS USED BY TEST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

IPv4 Subnets (All must be routable on physical network):
â”œâ”€ 192.168.100.0/24  â†’ IPv4 Whereabouts IPAM
â”œâ”€ 192.168.101.0/24  â†’ IPv4 Static IPAM
â”œâ”€ 192.168.200.0/24  â†’ Dual-stack Whereabouts IPv4
â””â”€ 192.168.201.0/24  â†’ Dual-stack Static IPv4

IPv6 Subnets (Only needed if testing IPv6):
â”œâ”€ fd00:192:168:100::/64  â†’ IPv6 Whereabouts IPAM
â”œâ”€ fd00:192:168:101::/64  â†’ IPv6 Static IPAM
â”œâ”€ fd00:192:168:200::/64  â†’ Dual-stack Whereabouts IPv6
â””â”€ fd00:192:168:201::/64  â†’ Dual-stack Static IPv6

Physical Network Must:
â”œâ”€ Route all above subnets
â”œâ”€ Support MAC addresses from VFs
â”œâ”€ Have port security disabled (for VF MACs)
â””â”€ Support both IPv4 and IPv6 (for full testing)


âœ… SUMMARY: REQUIRED FOR TEST TO RUN FULLY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Hardware:
  âœ… SR-IOV capable NIC (Intel X520, Mellanox ConnectX-5+, etc.)
  âœ… 6-8 Virtual Functions available
  âœ… IOMMU enabled in BIOS (VT-d or AMD-Vi)
  âœ… SR-IOV driver loaded on host

Network:
  âœ… Physical network connected to NIC
  âœ… Switch with port security disabled
  âœ… IPv4 routing for 192.168.100.0/24 - 192.168.201.0/24
  âœ… IPv6 routing for fd00:192:168:100::/64 - fd00:192:168:201::/64 (optional)

Kubernetes:
  âœ… SR-IOV operator running
  âœ… SR-IOV CNI plugin deployed
  âœ… Multus CNI deployed
  âœ… NetworkAttachmentDefinition resources created

Physical Link:
  âœ… Carrier status: UP (cable connected and port up)
  âœ… Link speed: Negotiated
  âœ… No packet loss on network


â­ï¸  NEXT STEPS IF TEST FAILS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

If Test Skipped:
  1. Check for SR-IOV hardware: lspci | grep -i "virtual"
  2. Verify IOMMU enabled: cat /proc/cmdline | grep iommu
  3. Check SR-IOV driver: lsmod | grep -i sriov
  
If Pods Stuck in ContainerCreating:
  1. Check NAD created: oc get networkattachmentdefinition -A
  2. Check operator logs: oc logs -n openshift-sriov-network-operator
  3. See: SRIOV_OPERATOR_BUG_ANALYSIS.md
  
If Ping Fails (NO-CARRIER):
  1. Check physical cable connected
  2. Check switch port is up: ethtool ens1f0
  3. Check VF created: ip link show | grep vf
  
If Ping Fails (Timeout):
  1. Check network route exists
  2. Check firewall rules
  3. Verify packet forwarding enabled


ğŸ“„ MORE DETAILED ANALYSIS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

See: SRIOV_NETWORKING_TEST_PHYSICAL_REQUIREMENTS.md

This file contains:
  â€¢ Supported SR-IOV hardware list
  â€¢ Physical network architecture diagrams
  â€¢ Detailed connectivity requirements per test scenario
  â€¢ What happens if components are missing
  â€¢ Graceful degradation behavior
  â€¢ Minimal physical setup requirements

