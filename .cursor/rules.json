{
  "project": {
    "name": "eco-gotests SR-IOV Testing",
    "type": "go-testing",
    "context": "OpenShift SR-IOV Networking Tests"
  },
  "rules": [
    {
      "selector": "tests/sriov/**/*.go",
      "language": "go",
      "rules": {
        "linter": "golangci-lint",
        "formatter": "gofmt",
        "context": "SR-IOV Testing Framework - Ginkgo v2 + eco-goinfra",
        "imports": [
          "github.com/rh-ecosystem-edge/eco-goinfra/pkg/clients",
          "github.com/rh-ecosystem-edge/eco-goinfra/pkg/sriov",
          "github.com/rh-ecosystem-edge/eco-goinfra/pkg/namespace",
          "github.com/rh-ecosystem-edge/eco-goinfra/pkg/pod",
          "github.com/rh-ecosystem-edge/eco-goinfra/pkg/nodes",
          "github.com/rh-ecosystem-edge/eco-goinfra/pkg/nad",
          "github.com/onsi/ginkgo/v2",
          "github.com/onsi/gomega",
          "k8s.io/api/core/v1",
          "k8s.io/apimachinery/pkg/apis/meta/v1",
          "k8s.io/apimachinery/pkg/util/wait",
          "sigs.k8s.io/controller-runtime/pkg/client"
        ],
        "patterns": {
          "required": [
            "defer func() { cleanup }() for resource cleanup",
            "GinkgoLogr.Info() for logging",
            "Eventually() for assertions with timeout",
            "Expect().NotTo(HaveOccurred()) for error checking",
            "Namespace/Pod cleanup with timeouts",
            "Node readiness verification before operations",
            "YAML string quoting for 'on'/'off' values"
          ],
          "forbidden": [
            "direct kubectl calls without eco-goinfra wrappers",
            "unsafe nil pointer dereferences",
            "unquoted YAML boolean string values",
            "missing error handling",
            "missing resource cleanup"
          ]
        },
        "test_patterns": {
          "structure": "Ginkgo BDD style (Describe/It blocks)",
          "naming": "Author:ID-Description [Tags]",
          "tags": [
            "[Disruptive] - modifies cluster state",
            "[Serial] - must run sequentially",
            "[Slow] - takes > 5 minutes"
          ],
          "timeout": "90 minutes for full suite, 60 minutes for single test"
        }
      }
    },
    {
      "selector": "tests/sriov/testdata/**/*.yaml",
      "language": "yaml",
      "rules": {
        "linter": "yamllint",
        "context": "SR-IOV Kubernetes Resource Templates",
        "patterns": {
          "required": [
            "String values must be quoted",
            "Template variables properly escaped",
            "Valid Kubernetes resource structure"
          ],
          "forbidden": [
            "Unquoted 'on'/'off' values",
            "Invalid YAML syntax",
            "Incomplete templates"
          ]
        }
      }
    },
    {
      "selector": "tests/sriov/README.md",
      "language": "markdown",
      "rules": {
        "context": "SR-IOV Documentation",
        "sections": [
          "Setup Instructions",
          "Device Configuration",
          "Running Tests",
          "Troubleshooting",
          "Test Cases Overview"
        ]
      }
    }
  ],
  "coding_standards": {
    "go": {
      "style": "Follow Go conventions (gofmt)",
      "error_handling": "Always check and log errors",
      "logging": "Use GinkgoLogr.Info with key-value pairs",
      "cleanup": "Use defer() for all resource cleanup",
      "context": "Always use context.WithTimeout for operations"
    }
  },
  "sr_iov_specific": {
    "key_concepts": [
      "SriovNetworkNodePolicy - VF configuration per node",
      "SriovNetwork - Network attachment definition",
      "NetworkAttachmentDefinition - CNI plugin configuration",
      "SriovNetworkNodeState - Operator sync status per node"
    ],
    "common_issues": [
      "Pod node name empty - refresh pod after scheduling",
      "YAML parsing errors - quote all string values",
      "Premature success - verify operator sync status",
      "Resource accumulation - cleanup before tests",
      "Pod inaccessibility - handle network errors gracefully",
      "Vendor mismatch - sync go.mod and vendor/modules.txt"
    ],
    "test_flow": [
      "1. Verify cluster/nodes ready",
      "2. Verify SR-IOV operator deployed",
      "3. Create SriovNetworkNodePolicy",
      "4. Wait for policy to be applied",
      "5. Create test namespace",
      "6. Create SriovNetwork",
      "7. Wait for NAD creation",
      "8. Create test pods",
      "9. Run connectivity tests",
      "10. Cleanup all resources"
    ]
  },
  "environment": {
    "required_vars": {
      "SRIOV_DEVICES": "Device configuration: name:deviceid:vendor:interface",
      "KUBECONFIG": "Path to OpenShift cluster kubeconfig"
    },
    "optional_vars": {
      "ECO_SRIOV_TEST_CONTAINER": "Custom container image for multi-arch support"
    }
  }
}

